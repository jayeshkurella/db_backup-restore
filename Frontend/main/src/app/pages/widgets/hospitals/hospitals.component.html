<div class="px-3 py-3 mat-elevation-z1">
  <!-- Header Row: Left Title + Right Add Button -->
  <div class="d-flex justify-content-end align-items-end ">
    <button *ngIf="isAdmin"
            mat-flat-button
            color="primary"
            (click)="addhospital()"
            class="d-flex align-items-center">
      <mat-icon>add</mat-icon>&nbsp;Add Hospital
    </button>
  </div>
  

  <form (ngSubmit)="onsearch()" novalidate>
    <h6 class="mb-3">Search Filters</h6>

    <div class="d-flex flex-wrap align-items-end gap-3 w-100 border-bottom pb-3 mb-3">
      
      <!-- Name -->
      <mat-form-field appearance="outline" class="with-icon flex-grow-1 ">
        <mat-label>Name</mat-label>
        <input matInput [(ngModel)]="searchName" name="searchName" placeholder="Search by name" (ngModelChange)="onsearch()">
        <mat-icon matPrefix>Hospital</mat-icon>
      </mat-form-field>

      <!-- State -->
      <mat-form-field appearance="outline" class="w-auto min-width-200">
        <mat-select [(ngModel)]="searchstate" name="state" (selectionChange)="onStateChange()" (ngModelChange)="onsearch()">
          <mat-option value="">State</mat-option>
          <mat-option *ngFor="let state of allstates" [value]="state">{{ state }}</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- District -->
      <mat-form-field appearance="outline" class="w-auto min-width-200">
        <mat-select [(ngModel)]="searchdistrict" name="district" (selectionChange)="onDistrictChange()" (ngModelChange)="onsearch()">
          <mat-option value="">District</mat-option>
          <mat-option *ngFor="let district of alldistricts" [value]="district">{{ district }}</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- City -->
      <mat-form-field appearance="outline" class="w-auto min-width-200">
        <mat-select [(ngModel)]="searchCity" name="city" (ngModelChange)="onsearch()">
          <mat-option value="">City</mat-option>
          <mat-option *ngFor="let city of allcities" [value]="city">{{ city }}</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Hospital Type -->
      <mat-form-field appearance="outline" class="w-auto min-width-200">
        <mat-select [(ngModel)]="searchtype" name="type" (ngModelChange)="onsearch()">
          <mat-option value="">All Types</mat-option>
          <mat-option value="gvt">Government</mat-option>
          <mat-option value="semi_gvt">Semi-Government</mat-option>
          <mat-option value="private">Private</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Search Button -->
      <!-- <button mat-flat-button color="primary" class="d-flex align-items-center" style="margin-bottom: 17px;">
        <mat-icon>search</mat-icon>&nbsp;Search
      </button> -->
    </div>
  </form>

  <div class="row p-2 mt-1">
    <!-- Loading Spinner -->
    <div *ngIf="loading" class="d-flex justify-content-center align-items-center" style="height: 300px;">
      <mat-spinner diameter="50"></mat-spinner>
    </div>
  
    <!-- Hospital Cards -->
    <ng-container *ngIf="!loading">
      <div class="col-sm-6 col-lg-4 d-flex align-items-stretch" *ngFor="let hospital of allhospitals">
        <mat-card class="cardWithShadow overflow-hidden w-100">
          
          <!-- Image Section -->
          <div class="position-relative">
            <img
              *ngIf="hospital.hospital_photo; else placeholder"
              [src]="environment.apiUrl + hospital.hospital_photo"
              class="w-100 object-fit-cover p-1"
              style="height: 200px; border-radius: 8px;"
              alt="{{ hospital.name }}"
            />
            <ng-template #placeholder>
              <div class="w-100 d-flex align-items-center justify-content-center bg-light" style="height: 200px;">
                <i class="bi bi-image" style="font-size: 3rem; color: #ccc;"></i>
              </div>
            </ng-template>
          </div>
  
          <!-- Card Content -->
          <mat-card-content class="p-3">
  
            <!-- Name and Type -->
            <div class="d-flex justify-content-between align-items-start">
              <h6 class="fw-bold mb-0" style="white-space: normal; word-wrap: break-word; width: 100%; text-align: left; min-height: 2.4rem; line-height: 1.2rem;">
                {{ hospital.name }}
              </h6>
              <span class="badge px-2 py-1"
                    [ngClass]="{
                      'bg-success text-white': hospital.type === 'gvt',
                      'bg-info text-white': hospital.type === 'semi-government',
                      'bg-warning text-white': hospital.type === 'private'
                    }">
                {{ hospital.type | titlecase }}
              </span>

            </div>
  
            <!-- Address and Contact -->
            <div class="d-flex justify-content-between text-muted f-s-14 mb-5">
              <div class="d-flex align-items-center">
                <i class="bi bi-geo-alt me-1"></i>
                {{ hospital.address_details.city }}, {{ hospital.address_details.state }}
              </div>
              <div class="d-flex align-items-center">
                <i class="bi bi-telephone me-1"></i>
                {{ hospital.hospital_contact[0]?.phone_no || 'N/A' }}
              </div>
            </div>
  
            <!-- Button -->
            <div class="d-flex justify-content-center mt-3">
              <button mat-stroked-button color="primary" class="w-100 px-4" (click)="seeMoreHospitaldata(hospital)">
                More Info
              </button>
            </div>
  
          </mat-card-content>
        </mat-card>
      </div>
  
      <!-- Empty State -->
      <div *ngIf="allhospitals?.length === 0" class="col-12 text-center py-5">
        <mat-icon class="text-muted" style="font-size: 48px;">location_off</mat-icon>
        <h5 class="text-muted mt-3">No hospitals found</h5>
      </div>
    </ng-container>
  </div>
  
  <!-- Pagination -->
  <div class="row mt-3">
    <div class="col-12 d-flex justify-content-center">
      <mat-paginator *ngIf="!loading && totalHospitalItems > 0"
        [length]="totalHospitalItems"
        [pageSize]="itemsPerPage"
        [pageIndex]="currentPage - 1"
        [hidePageSize]="true"
        (page)="onHospitalPageChange($event)"
        aria-label="Select page">
      </mat-paginator>
    </div>
  </div>
</div>