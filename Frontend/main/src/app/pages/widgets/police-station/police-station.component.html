<div class="page-container mat-elevation-z2 footer">
  <div class="header-container d-flex justify-content-between align-items-center mb-3">
    <!-- Left side: Title -->
    <h2 class="page-title m-0">Police Station</h2>

    <!-- Right side: Add Button -->
    <button *ngIf="isLoggedIn && isAdmin" mat-flat-button color="primary" (click)="navigateToAddStation()"
      class="action-btn d-flex align-items-center">
      <mat-icon class="add-icon">add</mat-icon>Add
    </button>
  </div>

  <form (ngSubmit)="onSearch()" novalidate>
    <!-- Filters Row -->
    <div class="d-flex align-items-end gap-2 w-100 flex-nowrap overflow-auto pb-2 mt-3 filters-row">
      <mat-form-field appearance="outline" class="with-icon flex-grow-1 min-width-200">
        <input matInput [(ngModel)]="searchFilters.name" (ngModelChange)="onSearch()" name="searchName" placeholder="Search by Name"
          class="field-color" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-auto min-width-200">
        <mat-select [(ngModel)]="searchFilters.state" name="state" (selectionChange)="onStateChange()"
          class="field-color">
          <mat-option value="">All States</mat-option>
          <mat-option *ngFor="let state of allstates" [value]="state">{{
            state
            }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-auto min-width-200">
        <mat-select [(ngModel)]="searchFilters.district" name="district" (selectionChange)="onDistrictChange()"
          class="field-color">
          <mat-option value="">All Districts</mat-option>
          <mat-option *ngFor="let district of alldistricts" [value]="district">{{ district }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-auto min-width-200">
        <mat-select [(ngModel)]="searchFilters.city" name="city" class="field-color">
          <mat-option value="">City</mat-option>
          <mat-option *ngFor="let city of allcities" [value]="city">{{
            city
            }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Buttons Row -->
   <div class="d-flex justify-content-end gap-3 mb-3 buttons-row">
      <button mat-stroked-button color="primary" type="button" (click)="resetFilters()"
        class="d-flex align-items-center justify-content-center">
        <mat-icon>refresh</mat-icon>&nbsp;&nbsp;Reset
      </button>
        <button mat-flat-button color="primary" type="submit" class="d-flex align-items-center justify-content-center">
        <mat-icon>search</mat-icon>Search
      </button>
    </div>
  </form>

  <div class="row p-2">
    <!-- Loading Spinner -->
    <div *ngIf="loading" class="d-flex justify-content-center align-items-center" style="height: 300px">
      <mat-spinner diameter="50"></mat-spinner>
    </div>

    <!-- Police Station Cards -->
    <ng-container *ngIf="!loading">
      <div class="col-sm-6 col-lg-3 d-flex align-items-stretch" *ngFor="let police of total_policestation">
        <mat-card class="cardWithShadow overflow-hidden w-100">
          <!-- Image Section -->
          <div class="position-relative">
            <img [src]="environment.ImgUrlss + police.station_photo" class="w-100 object-fit-cover"
              style="height: 200px" alt="{{ police.name }}" (error)="onImageError($event)" />

            <ng-template #placeholder>
              <div class="w-100 d-flex align-items-center justify-content-center bg-light" style="height: 200px">
                <i class="bi bi-image" style="font-size: 3rem; color: #ccc"></i>
              </div>
            </ng-template>
          </div>

          <!-- Card Content -->
          <mat-card-content class="p-3 d-flex flex-column" style="height: 100%">
            <!-- Name and Status -->
            <div class="d-flex justify-content-between align-items-start">
              <h6 class="fw-bold mb-0" style="
                  white-space: normal;
                  word-wrap: break-word;
                  width: 100%;
                  text-align: left;
                  min-height: 2.4rem;
                  line-height: 1.2rem;
                ">
                {{ police.name }}
              </h6>
              <span class="badge px-2 py-1 bg-warning text-white">
                {{ police.activ_Status }}
              </span>
            </div>

            <!-- Address and Contact -->
            <div class="d-flex flex-column text-muted f-s-14 mt-3 mb-3">
              <div class="d-flex align-items-center mb-1">
                <i class="bi bi-geo-alt me-2"></i>
                <span>
                  {{ police.address_details.city }},
                  {{ police.address_details.state | stateAbbreviation }}
                </span>
              </div>
              <div class="d-flex align-items-center">
                <i class="bi bi-telephone me-2"></i>
                <span>{{ police.police_contact[0]?.phone_no || "N/A" }}</span>
              </div>
            </div>

            <!-- Button pushed to bottom -->
            <div class="d-flex justify-content-center mt-auto">
              <button mat-stroked-button color="primary" class="w-100 px-4" (click)="seeMorepolicestationdata(police)">
                More Info
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Empty State -->
      <div *ngIf="total_policestation?.length === 0" class="col-12 text-center py-5">
        <mat-icon class="text-muted" style="font-size: 48px">location_off</mat-icon>
        <h5 class="text-muted mt-3">No police stations found</h5>
      </div>
    </ng-container>
  </div>
  <!-- Pagination -->
  <div class="row mt-3">
    <div class="col-12 d-flex justify-content-center">
      <mat-paginator *ngIf="!loading && totalItems > 0" [length]="totalItems" [pageSize]="itemsPerPage"
        [pageIndex]="currentPage - 1" [hidePageSize]="true" (page)="onPageChange($event)" aria-label="Select page">
      </mat-paginator>
    </div>
  </div>
</div>