<div class="approval-container">
    <mat-card>
      <mat-card-content>
        
        <mat-tab-group [(selectedIndex)]="selectedTabIndex">
          <mat-tab label="Pending ({{pendingCount}})"></mat-tab>
          <mat-tab label="Rejected ({{rejectedCount}})"></mat-tab>
          <mat-tab label="Approved ({{approvedCount}})"></mat-tab>
        </mat-tab-group>
  
        <div class="select-all-container">
            <div class="select-action-wrapper">
              <div class="select-box">
                <mat-checkbox color="primary" 
                  *ngIf="selectedTabIndex === 0"
                  [checked]="selectAllPending"
                  [indeterminate]="isIndeterminatePending()"
                  (change)="toggleSelectAllPending($event.checked)">
                  Select All Pending ({{pendingCount}})
                </mat-checkbox>
          
                <mat-checkbox color="primary" 
                  *ngIf="selectedTabIndex === 1"
                  [checked]="selectAllRejected"
                  [indeterminate]="isIndeterminateRejected()"
                  (change)="toggleSelectAllRejected($event.checked)">
                  Select All Rejected ({{rejectedCount}})
                </mat-checkbox>

                <mat-checkbox color="primary" 
                    *ngIf="selectedTabIndex === 2"
                    [checked]="selectAllApproved"
                    [indeterminate]="isIndeterminateApproved()"
                    (change)="toggleSelectAllApproved($event.checked)">
                    Select All Approved ({{approvedCount}})
                </mat-checkbox>

              </div>
          
              <div class="action-buttons">
                <ng-container *ngIf="selectedTabIndex === 0">
                  <button mat-stroked-button color="primary" 
                          (click)="approveSelected()"
                          [disabled]="!hasSelectedItems()">
                    Approve Selected ({{selectedCount()}})
                  </button>
                  <button mat-stroked-button color="warn" 
                          (click)="rejectSelected()"
                          [disabled]="!hasSelectedItems()"
                          class="reject-button">
                    Reject Selected ({{selectedCount()}})
                  </button>
                </ng-container>
            
                <ng-container *ngIf="selectedTabIndex === 1">
                  <button mat-stroked-button color="primary" 
                          (click)="approveSelected()"
                          [disabled]="!hasSelectedItems()">
                    Approve Selected ({{selectedCount()}})
                  </button>
                </ng-container>
          
                <ng-container *ngIf="selectedTabIndex === 2">
                  <button mat-stroked-button 
                          (click)="setPendingSelected()"
                          [disabled]="!hasSelectedItems()">
                    Set as Pending ({{selectedCount()}})
                  </button>
                  <button mat-stroked-button color="warn" 
                          (click)="rejectSelected()"
                          [disabled]="!hasSelectedItems()"
                          class="reject-button">
                    Reject Selected ({{selectedCount()}})
                  </button>
                </ng-container>
              </div>
            </div>
          </div>
          
  
        <div *ngIf="isLoading" class="loading-spinner">
          <mat-spinner diameter="50"></mat-spinner>
        </div>
  
        <table *ngIf="!isLoading" mat-table [dataSource]="getCurrentDataSource()" class="mat-elevation-z1">

            <ng-container matColumnDef="select">
                <th mat-header-cell *matHeaderCellDef>
                </th>
                <td mat-cell *matCellDef="let person">
                  <mat-checkbox color="primary" 
                               [(ngModel)]="person.selected"
                               (click)="$event.stopPropagation()"
                               (change)="updateSelectAllState()">
                  </mat-checkbox>
                </td>
              </ng-container>

          <ng-container matColumnDef="full_name">
            <th mat-header-cell *matHeaderCellDef>FULL NAME</th>
            <td mat-cell *matCellDef="let person">
              <div class="name-cell">
                <div class="name">{{getFullName(person)}}</div>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="email_id">
            <th mat-header-cell *matHeaderCellDef>EMAIL</th>
            <td mat-cell *matCellDef="let person">{{person.email_id}}</td>
          </ng-container>

          <ng-container matColumnDef="phone">
            <th mat-header-cell *matHeaderCellDef>PHONE</th>
            <td mat-cell *matCellDef="let person">{{getPhoneNumber(person)}}</td>
          </ng-container>

          <ng-container matColumnDef="user_type">
            <th mat-header-cell *matHeaderCellDef>TYPE</th>
            <td mat-cell *matCellDef="let person">{{person.user_type | titlecase}}</td>
          </ng-container>

          <ng-container matColumnDef="sub_user_type">
            <th mat-header-cell *matHeaderCellDef>SUBTYPE</th>
            <td mat-cell *matCellDef="let person">{{person.sub_user_type | titlecase}}</td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>STATUS</th>
            <td mat-cell *matCellDef="let person">
              <span class="status-badge" 
                    [class.pending]="person.status === 'hold'"
                    [class.approved]="person.status === 'approved'"
                    [class.rejected]="person.status === 'rejected'">
                {{person.status | titlecase}}
              </span>
            </td>
          </ng-container>

          <ng-container matColumnDef="status_updated_by">
            <th mat-header-cell *matHeaderCellDef>UPDATED BY</th>
            <td mat-cell *matCellDef="let person">{{person.status_updated_by || '-'}}</td>
          </ng-container>

          <ng-container matColumnDef="registered_at">
            <th mat-header-cell *matHeaderCellDef>REGISTERED AT</th>
            <td mat-cell *matCellDef="let person">{{person.registered_at | date:'medium'}}</td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>ACTIONS</th>
            <td mat-cell *matCellDef="let person">
              <ng-container *ngIf="selectedTabIndex === 0">
                <button mat-icon-button color="primary" (click)="approvePerson(person)" matTooltip="Approve">
                  <mat-icon>check</mat-icon>
                </button>
                <button mat-icon-button color="warn" (click)="rejectPerson(person)" matTooltip="Reject">
                  <mat-icon>close</mat-icon>
                </button>
              </ng-container>
              
              <ng-container *ngIf="selectedTabIndex === 1">
                <button mat-icon-button color="primary" (click)="approvePerson(person)" matTooltip="Approve">
                  <mat-icon>check</mat-icon>
                </button>
              </ng-container>

              <ng-container *ngIf="selectedTabIndex === 2">
                <button mat-icon-button (click)="setPersonPending(person)" matTooltip="Set as Pending">
                  <mat-icon>schedule</mat-icon>
                </button>
                <button mat-icon-button color="warn" (click)="rejectPerson(person)" matTooltip="Reject">
                  <mat-icon>close</mat-icon>
                </button>
              </ng-container>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsWithSelect"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsWithSelect;"></tr>
        </table>
      </mat-card-content>
    </mat-card>
  </div>