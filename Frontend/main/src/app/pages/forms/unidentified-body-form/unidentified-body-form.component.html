<div class="unidentified-person-form-container p-4 bg-white rounded shadow-sm">
  <div class="heading-container">
    <h3 class="main-heading">UNIDENTIFIED BODY REPORT FORM</h3>
  </div>

  <form [formGroup]="unidentifiedBodyForm" (ngSubmit)="onSubmit()" enctype="multipart/form-data">
    <!-- Personal Info Section -->
    <div class="p-3 bg-light-primary rounded">
      <h5 class="f-s-14 text-primary d-flex align-items-center f-w-600">
        <i-tabler name="info-circle" class="icon-20 me-2 d-flex"></i-tabler>
        Personal Info
      </h5>
    </div>

    <mat-card class="p-4 m-1 mb-4">
      <div class="row g-2 p-3">
        <!-- Full Name -->
        <div class="col-12 col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Full Name</mat-label>
            <input matInput type="text" formControlName="full_name" maxlength="30" />
            <mat-error *ngIf="unidentifiedBodyForm.get('full_name')?.hasError('pattern') && unidentifiedBodyForm.get('full_name')?.touched">
  Name must contain only letters (A-Z) and be up to 30 characters
</mat-error>
          </mat-form-field>
        </div>

        <!-- Gender -->
        <div class="col-12 col-md-3">
          <mat-form-field appearance="outline" class="w-100">
            <!-- <mat-label>Gender</mat-label> -->
            <mat-select formControlName="gender" required>
              <mat-option value="">Select Gender</mat-option>
              <mat-option value="male">Male</mat-option>
              <mat-option value="female">Female</mat-option>
            </mat-select>
            <mat-error *ngIf="unidentifiedBodyForm.get('gender')?.hasError('required')">
              Please select the Gender
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Date of Birth -->
        <div class="col-12 col-md-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Date of Birth</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="birth_date">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
        </div>

        <!-- Age Range -->
      <div class="col-12 col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Age Range</mat-label>
              <mat-select formControlName="age_range">
                <mat-option *ngFor="let range of [
                  ['0-5', '0 - 5'], ['6-12', '6 - 12'], ['13-17', '13 - 17'],
                  ['18-24', '18 - 24'], ['25-34', '25 - 34'], ['35-44', '35 - 44'],
                  ['45-54', '45 - 54'], ['55-64', '55 - 64'], ['65-74', '65 - 74'],
                  ['75-84', '75 - 84'], ['85-100', '85+']
                ]" [value]="range[0]">
                  {{ range[1] }}
                </mat-option>
              </mat-select>
              
            </mat-form-field>
          </div>
        <!-- Blood Group -->
        <div class="col-12 col-md-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Blood Group</mat-label>
            <mat-select formControlName="blood_group">
              <mat-option value="A+">A+</mat-option>
              <mat-option value="O+">O+</mat-option>
              <mat-option value="B+">B+</mat-option>
              <mat-option value="AB+">AB+</mat-option>
              <mat-option value="AB-">AB-</mat-option>
              <mat-option value="A-">A-</mat-option>
              <mat-option value="O-">O-</mat-option>
              <mat-option value="B-">B-</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Height -->
        <div class="col-12 col-md-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Height (cm)</mat-label>
            <input matInput type="number" formControlName="height" max="250" />
            <mat-error *ngIf="unidentifiedBodyForm.get('height')?.hasError('max')">
              Height cannot exceed 250cm
            </mat-error>
            <mat-error *ngIf="unidentifiedBodyForm.get('height')?.hasError('pattern')">
              Please enter a valid number
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Weight -->
        <div class="col-12 col-md-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Weight (kg)</mat-label>
            <input matInput type="number" formControlName="weight" max="200" />
            <mat-error *ngIf="unidentifiedBodyForm.get('weight')?.hasError('max')">
              Weight cannot exceed 200kg
            </mat-error>
            <mat-error *ngIf="unidentifiedBodyForm.get('weight')?.hasError('pattern')">
              Please enter a valid number
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Complexion -->
        <div class="col-12 col-md-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Complexion</mat-label>
            <mat-select formControlName="complexion">
              <mat-option value="fair">Fair</mat-option>
              <mat-option value="dusky">Dusky</mat-option>
              <mat-option value="wheatish">Wheatish</mat-option>
              <mat-option value="dark">Dark</mat-option>
              <mat-option value="medium">Medium</mat-option>
              <mat-option value="light">Light</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Hair Color -->
        <div class="col-12 col-md-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Hair Color</mat-label>
            <mat-select formControlName="hair_color">
              <mat-option value="black">Black</mat-option>
              <mat-option value="brown">Brown</mat-option>
              <mat-option value="grey">Grey</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Eye Color -->
        <div class="col-12 col-md-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Eye Color</mat-label>
            <mat-select formControlName="eye_color">
              <mat-option value="black">Black</mat-option>
              <mat-option value="brown">Brown</mat-option>
              <mat-option value="green">Green</mat-option>
              <mat-option value="hazel">Hazel</mat-option>
              <mat-option value="gray">Gray</mat-option>
              <mat-option value="yellow">Yellow</mat-option>
              <mat-option value="blue">Blue</mat-option>
              <mat-option value="violet">Violet</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Hair Type -->
        <div class="col-12 col-md-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Hair Type</mat-label>
            <mat-select formControlName="hair_type">
              <mat-option value="straight">Straight</mat-option>
              <mat-option value="dashed">Dashed</mat-option>
              <mat-option value="dotted">Dotted</mat-option>
              <mat-option value="long">Long</mat-option>
              <mat-option value="broad">Broad</mat-option>
              <mat-option value="short">Short</mat-option>
              <mat-option value="wavy">Wavy</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Birthmark -->
        <div class="col-12 col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Birthmark Details</mat-label>
            <textarea matInput formControlName="birth_mark" rows="3" maxlength="250"></textarea>
            <mat-error *ngIf="unidentifiedBodyForm.get('birth_mark')?.hasError('maxlength')">
              Maximum 250 characters allowed
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Distinctive Marks -->
        <div class="col-12 col-md-6">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Distinctive Marks</mat-label>
            <textarea matInput formControlName="distinctive_mark" rows="3" maxlength="250"></textarea>
            <mat-error *ngIf="unidentifiedBodyForm.get('distinctive_mark')?.hasError('maxlength')">
              Maximum 250 characters allowed
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Select Hospital -->
        <div class="col-12 col-md-4">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Select Hospitals</mat-label>
            <mat-select formControlName="hospital">
              <mat-option *ngFor="let hospital of hospitals" [value]="hospital.id">
                {{ hospital.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Body Condition -->
        <div class="col-12 col-md-4">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Body Condition</mat-label>
            <mat-select formControlName="bodies_condition" multiple>
              <mat-option value="decomposed">Decomposed</mat-option>
              <mat-option value="intact">Intact</mat-option>
              <mat-option value="skeletal">Skeletal</mat-option>
              <mat-option value="burnt">Burnt</mat-option>
              <mat-option value="fresh">Fresh</mat-option>
              <mat-option value="normal">Normal</mat-option>
              <mat-option value="unstable">Unstable</mat-option>
              <mat-option value="stable">Stable</mat-option>
              <mat-option value="excess">Excess</mat-option>
              <mat-option value="underweight">Underweight</mat-option>
              <mat-option value="overweight">Overweight</mat-option>
              <mat-option value="obese">Obese</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Body Photo Upload -->
        <div class="col-md-4" style="margin-bottom: 20px;">
          <button mat-stroked-button color="primary" class="w-100" type="button" (click)="personPhotoInput.click()">
            <mat-icon>cloud_upload</mat-icon>Person Photo
          </button>
          <input
            #personPhotoInput
            type="file"
            accept="image/*"
            hidden
            (change)="onFileSelect_person_photo($event)"
          />
        </div>
      </div>
    </mat-card>

    <!-- Address Section -->
    <div class="p-3 bg-light-primary rounded mt-4 mb-2 d-flex justify-content-between align-items-center">
      <h5 class="f-s-14 text-primary d-flex align-items-center f-w-600 mb-0">
        <i-tabler name="info-circle" class="icon-20 me-2 d-flex"></i-tabler> Address
      </h5>
      <button mat-flat-button color="primary" type="button" (click)="addAddress()">Add Another Address</button>
    </div>
    
    <mat-card class="p-3 mb-4">
      <div formGroupName="addressForm" class="row g-3 m-2">
        <!-- Left Section: Address Fields -->
        <div class="col-md-6">
          <div class="row g-2">
            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-select formControlName="address_type">
                  <mat-option value="" disabled>Address Type</mat-option>
                  <mat-option value="permanent">Permanent</mat-option>
                  <mat-option value="current">Current</mat-option>
                  <mat-option value="old">Old</mat-option>
                </mat-select>
                <mat-error *ngIf="unidentifiedBodyForm.get('address_type')?.hasError('maxlength')">
                  Maximum 200 characters allowed
                </mat-error>
              </mat-form-field>
            </div>

            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Street</mat-label>
                <input matInput type="text" formControlName="street" maxlength="30">
                <mat-error *ngIf="unidentifiedBodyForm.get('street')?.hasError('pattern')">
                  Street must be alphanumeric and up to 30 characters
                </mat-error>
              </mat-form-field>
            </div>
              <div class="col-md-12">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Landmark Details</mat-label>
                <textarea matInput formControlName="landmark_details" rows="1" maxlength="30"></textarea>
                <mat-error *ngIf="unidentifiedBodyForm.get('landmark_details')?.hasError('maxlength')">
                  Maximum 30 characters allowed
                </mat-error>
              </mat-form-field>
            </div>
            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Village</mat-label>
                <input matInput type="text" formControlName="village" maxlength="30">
                <mat-error *ngIf="unidentifiedBodyForm.get('village')?.hasError('pattern')">
                  Village must contain only letters and be up to 30 characters
                </mat-error>
              </mat-form-field>
            </div>

            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>City</mat-label>
                <input matInput type="text" formControlName="city" maxlength="30">
                <mat-error *ngIf="unidentifiedBodyForm.get('city')?.hasError('pattern')">
                  City must contain only letters and be up to 30 characters
                </mat-error>
              </mat-form-field>
            </div>

            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>District</mat-label>
                <input matInput type="text" formControlName="district" maxlength="30">
                <mat-error *ngIf="unidentifiedBodyForm.get('district')?.hasError('pattern')">
                  District must contain only letters and be up to 30 characters
                </mat-error>
              </mat-form-field>
            </div>

            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>State</mat-label>
                <input matInput type="text" formControlName="state" maxlength="30">
                <mat-error *ngIf="unidentifiedBodyForm.get('state')?.hasError('pattern')">
                  State must contain only letters and be up to 30 characters
                </mat-error>
              </mat-form-field>
            </div>

            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Pincode</mat-label>
                <input matInput type="text" formControlName="pincode" maxlength="15">
                <mat-error *ngIf="unidentifiedBodyForm.get('pincode')?.hasError('pattern')">
                  Please enter a valid pincode (up to 15 digits)
                </mat-error>
              </mat-form-field>
            </div>

            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Country</mat-label>
                <input matInput type="text" formControlName="country" maxlength="15">
                <mat-error *ngIf="unidentifiedBodyForm.get('country')?.hasError('pattern')">
                  Country must contain only letters and be up to 15 characters
                </mat-error>
              </mat-form-field>
            </div>

            
          </div>
        </div>

        <!-- Right Section: Map & Location -->
        <div class="col-md-6">
          <div formGroupName="location">
            <div class="d-flex gap-2">
              <mat-form-field appearance="outline" class="flex-grow-1 me-2">
                <mat-label>Latitude</mat-label>
                <input matInput type="text" formControlName="latitude" />
              </mat-form-field>
              
              <mat-form-field appearance="outline" class="flex-grow-1">
                <mat-label>Longitude</mat-label>
                <input matInput type="text" formControlName="longitude" />
              </mat-form-field>

              <button type="button" mat-icon-button (click)="getCurrentLocation()" matTooltip="Fetch your current location">
                <mat-icon>my_location</mat-icon>
              </button>
            </div>
            <div id="mapHome" style="height: 250px; border: 1px solid black; border-radius: 5px; z-index: 1;"></div>
          </div>
        </div>
      </div>

      <!-- Display Added Addresses -->
      <div *ngFor="let address of addresses.controls; let i = index" 
           class="d-flex align-items-center justify-content-between border-bottom py-2">
        <div class="flex-grow-1">
          <span class="address-title d-flex align-items-center">
            <mat-icon color="primary" class="me-2">place</mat-icon>
            <strong>{{ address.get('address_type')?.value || 'No type' }}:</strong>
          </span>
          <span class="address-text text-muted">
            {{ 
              (address.get('street')?.value ? address.get('street')?.value + ', ' : '') +
              (address.get('appartment_no')?.value ? 'Apt ' + address.get('appartment_no')?.value + ', ' : '') +
              (address.get('village')?.value ? address.get('village')?.value + ', ' : '') +
              (address.get('city')?.value ? address.get('city')?.value + ', ' : '') +
              (address.get('district')?.value ? address.get('district')?.value + ', ' : '') +
              (address.get('state')?.value ? address.get('state')?.value + ' - ' : '') +
              (address.get('pincode')?.value ? address.get('pincode')?.value : '') +
              (address.get('country')?.value ? ', ' + address.get('country')?.value : '')
            }}
          </span>
        </div>
        <button mat-icon-button color="warn" type="button" (click)="removeAddress(i)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </mat-card>

    <!-- Contact Section -->
    <div class="p-3 bg-light-primary rounded mt-4 mb-2 d-flex justify-content-between align-items-center">
      <h5 class="f-s-14 text-primary d-flex align-items-center f-w-600 mb-0">
        <i-tabler name="info-circle" class="icon-20 me-2 d-flex"></i-tabler> Contact
      </h5>
      <button mat-flat-button color="primary" type="button" (click)="addContact()">Add Another Contact</button>
    </div>

    <!-- Contact Information Card -->
    <mat-card class="p-3 mb-4">
      <form formGroupName="contactForm">
        <div class="row g-2 m-1">
          <!-- Contact Type -->
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-select formControlName="type">
                <mat-option value="referral">Referral Contact</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Company Name -->
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Name</mat-label>
              <input matInput type="text" formControlName="person_name">
              <mat-error *ngIf="unidentifiedBodyForm.get('person_name')?.hasError('pattern')">
                Name must contain only letters
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Phone Number -->
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Phone Number</mat-label>
              <input matInput type="text" formControlName="phone_no" maxlength="10">
              <mat-error *ngIf="unidentifiedBodyForm.get('phone_no')?.hasError('pattern')">
                Please enter a valid 10-digit phone number
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Email -->
          <div class="col-md-3">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Email</mat-label>
              <input matInput type="email" formControlName="email_id">
              <mat-error *ngIf="unidentifiedBodyForm.get('email_id')?.hasError('pattern')">
                Please enter a valid email address
              </mat-error>
            </mat-form-field>
          </div>

          <div class="col-md-12">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Additional Notes</mat-label>
              <textarea matInput type="text" formControlName="additional_details" maxlength="200"></textarea>
              <mat-error *ngIf="unidentifiedBodyForm.get('additional_details')?.hasError('maxlength')">
                Maximum 200 characters allowed
              </mat-error>
            </mat-form-field>
          </div>
        </div>
      </form>

      <mat-list class="mt-1">
        <mat-list-item *ngFor="let contact of contacts.controls; let i = index">
          <div class="w-100 d-flex align-items-center justify-content-between">
            <div class="contact-line">
              <span class="contact-type">
                <mat-icon class="text-primary">person</mat-icon>
                <strong>{{ contact.get('type')?.value }}:</strong>
              </span>
              
              <span class="contact-info">
                üìû {{ contact.get('phone_no')?.value || '' }} | 
                ‚úâÔ∏è {{ contact.get('email_id')?.value || '' }} | 
                üè¢ {{ contact.get('company_name')?.value || '' }} | 
                {{ contact.get('job_title')?.value || '' }}
              </span>
            </div>
      
            <!-- Remove Button -->
            <button mat-icon-button color="warn" type="button" (click)="removeContact(i)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </mat-list-item>
      </mat-list>
    </mat-card>
    
    <!-- Additional Information Section -->
    <div class="p-3 bg-light-primary rounded mt-4 mb-2 d-flex align-items-center" style="min-height: 60px;">
      <h5 class="f-s-14 text-primary d-flex align-items-center f-w-600 mb-0">
        <i-tabler name="info-circle" class="icon-20 me-2 d-flex"></i-tabler>
        Additional Information
      </h5>
    </div>
      
    <!-- Additional Information Card -->
    <mat-card class="p-4 mb-4 mt-2">
      <div formArrayName="additional_info">
        <div *ngFor="let info of additionalInfo.controls; let i = index" [formGroupName]="i" class="row g-3 p-3">
          <div class="row g-2">
            <!-- Caste -->
            <div class="col-md-3">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Caste</mat-label>
                <input matInput type="text" formControlName="caste" maxlength="30">
                <mat-error *ngIf="additionalInfo.controls[i].get('caste')?.hasError('pattern')">
                  Caste must contain only letters and be up to 30 characters
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Subcaste -->
            <div class="col-md-3">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Subcaste</mat-label>
                <input matInput type="text" formControlName="subcaste" maxlength="30">
                <mat-error *ngIf="additionalInfo.controls[i].get('subcaste')?.hasError('pattern')">
                  Subcaste must contain only letters and be up to 30 characters
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Marital Status -->
            <div class="col-md-3">
              <mat-form-field appearance="outline" class="w-100">
                <mat-select formControlName="marital_status">
                  <mat-option value="">Marital Status</mat-option>
                  <mat-option value="single">Single</mat-option>
                  <mat-option value="married">Married</mat-option>
                  <mat-option value="divorced">Divorced</mat-option>
                  <mat-option value="widowed">Widowed</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- Religion -->
            <div class="col-md-3">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Religion</mat-label>
                <mat-select formControlName="religion">
                  <mat-option value="hindu">Hindu</mat-option>
                  <mat-option value="muslim">Muslim</mat-option>
                  <mat-option value="sikh">Sikh</mat-option>
                  <mat-option value="christian">Christian</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- Mother Tongue -->
            <div class="col-md-3">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Mother Tongue</mat-label>
                <mat-select formControlName="mother_tongue">
                  <mat-option value="hindi">Hindi</mat-option>
                  <mat-option value="english">English</mat-option>
                  <mat-option value="marathi">Marathi</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- Known Languages -->
            <div class="col-md-3">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Other Known Languages</mat-label>
                <input matInput type="text" formControlName="other_known_languages">
                <mat-error *ngIf="additionalInfo.controls[i].get('other_known_languages')?.hasError('tooManyLanguages')">
                  Maximum 5 languages allowed
                </mat-error>
                <mat-error *ngIf="additionalInfo.controls[i].get('other_known_languages')?.hasError('invalidLanguageChars')">
                  Languages can only contain letters
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Identification Type -->
            <div class="col-md-3">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Identification Type</mat-label>
                <mat-select formControlName="id_type">
                  <mat-option value="aadhar_card">Aadhar Card</mat-option>
                  <mat-option value="pan_card">Pan Card</mat-option>
                  <mat-option value="driving_license">Driving License</mat-option>
                  <mat-option value="passport">Passport</mat-option>
                  <mat-option value="voter_id_card">VoterID</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- Identification Card Number -->
            <div class="col-md-3">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Identification Card Number</mat-label>
                <input matInput type="text" formControlName="id_no">
                <mat-error *ngIf="additionalInfo.controls[i].get('id_no')?.hasError('pattern')">
                  ID number must be alphanumeric
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Educational Details -->
            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Educational Details</mat-label>
                <input matInput type="text" formControlName="education_details">
              </mat-form-field>
            </div>

            <!-- Occupation -->
            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Occupation</mat-label>
                <input matInput type="text" formControlName="occupation_details" maxlength="30">
                <mat-error *ngIf="additionalInfo.controls[i].get('occupation_details')?.hasError('maxlength')">
                  Maximum 30 characters allowed
                </mat-error>
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>
    </mat-card>

    <!-- Legal Info Section -->
    <div class="p-3 bg-light-primary rounded mt-4 mb-2 d-flex align-items-center" style="min-height: 60px;">
      <h5 class="f-s-14 text-primary d-flex align-items-center f-w-600 mb-0">
        <i-tabler name="info-circle" class="icon-20 me-2 d-flex"></i-tabler>
        Legal Info
      </h5>
    </div>

    <mat-card class="card  p-4 mb-4">
      <div formArrayName="firs">
        <div *ngFor="let info of firs.controls; let i = index" [formGroupName]="i" class="row g-2 p-3">
          <!-- Case Status -->
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-select formControlName="case_status">
                <mat-option value="">Case Status</mat-option>
                <mat-option value="Open">Open</mat-option>
                <mat-option value="Resolved">Resolved</mat-option>
                <mat-option value="In Progress">In Progress</mat-option>
                <mat-option value="Closed">Closed</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <!-- FIR Number -->
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>FIR Number</mat-label>
              <input matInput type="text" formControlName="fir_number" maxlength="20">
              <mat-error *ngIf="firs.controls[i].get('fir_number')?.hasError('pattern')">
                FIR Number must be alphanumeric and up to 20 characters
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Upload FIR Photo -->
          <div class="col-md-4" style="margin-bottom: 20px;">
            <button mat-stroked-button color="primary" class="w-100" type="button" (click)="firInput.click()">
              <mat-icon>cloud_upload</mat-icon> Upload FIR Photo
            </button>
            <input
              #firInput
              type="file"
              accept="image/*,application/pdf"
              hidden
              (change)="onFileSelect($event, 'firs', i, 'document')"
            />
          </div>

          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Police Station Name</mat-label>
              <input matInput type="text" formControlName="police_station" maxlength="50">
              <mat-error *ngIf="firs.controls[i].get('police_station')?.hasError('pattern')">
                Police station name must contain only letters and be up to 50 characters
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Investigating Officer Name -->
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Investigating Officer's Name</mat-label>
              <input matInput type="text" formControlName="investigation_officer_name" maxlength="30">
              <mat-error *ngIf="firs.controls[i].get('investigation_officer_name')?.hasError('pattern')">
                Name must contain only letters and be up to 30 characters
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Investigating Officer Contact -->
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Investigating Officer's Contact Number</mat-label>
              <input matInput type="text" formControlName="investigation_officer_contacts">
              <mat-error *ngIf="firs.controls[i].get('investigation_officer_contacts')?.hasError('pattern')">
                Please enter a valid phone number
              </mat-error>
            </mat-form-field>
          </div>
        </div>
      </div>
    </mat-card>

    <!-- Consent Section -->
    <div class="p-3 bg-light-primary rounded mt-4 mb-2 d-flex align-items-center" style="min-height: 60px;">
      <h5 class="f-s-14 text-primary d-flex align-items-center f-w-600 mb-0">
        <i-tabler name="info-circle" class="icon-20 me-2 d-flex"></i-tabler>
        consent
      </h5>
    </div>

    <!-- Consent & Submission -->
    <mat-card class="card p-4 mb-1">
      <div formArrayName="consent">
        <div *ngFor="let info of consent.controls; let i = index" [formGroupName]="i" class="row g-3 p-3">
          <div class="col-md-12 consent-link">
            <a  (click)="openConsentDialog()">Click to open and acknowledge the consent document before proceeding.</a>
          </div>
        </div>
      </div>
    </mat-card>
  
  
      <!-- Submit & Cancel Buttons -->
      <div class="d-flex justify-content-between mt-4 space-down">
        <button mat-flat-button color="primary">Cancel</button>

        <span
          [matTooltip]="'Please accept the consent  before submitting.'"
          [matTooltipDisabled]="consent.controls[0].get('is_consent')?.value"
          matTooltipPosition="above"
        >
          <button mat-flat-button color="primary" class="ms-auto"
                  [disabled]="!consent.controls[0].get('is_consent')?.value">
            SUBMIT
          </button>
        </span>
      </div>
  
    </form>
  </div>