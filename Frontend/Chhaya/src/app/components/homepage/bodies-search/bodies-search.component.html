<div class="d-flex-container">
    <div class="container-fluid mt-2">
      <h2 class="text-center p-2 text-white bg-primary">Unidentified Bodies Search</h2>
  
      <div class="form-group row">
        <div class="col-md-6">
          <label for="bodyName">Enter Body Name</label>
          <input type="text" class="form-control" id="bodyName" [(ngModel)]="bodyName" placeholder="Enter body name" />
        </div>
      
        <div class="col-md-6">
          <label for="uniqueId">Enter Unique ID</label>
          <input type="text" class="form-control" id="uniqueId" [(ngModel)]="uniqueId" placeholder="Enter unique ID" />
        </div>
      </div>
      
      <button class="btn btn-primary w-100 mt-3" (click)="onSearch()" [disabled]="loading">
        Search
      </button>
      
  
      <div *ngIf="loading" class="mt-3 text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="sr-only">Loading...</span>
        </div>
      </div>
  
      <div *ngIf="errorMessage" class="mt-3 text-danger text-center">{{ errorMessage }}</div>
  
      <div *ngIf="!loading && searchResults" class="mt-4">
        <!-- Tabs -->
        <ul class="nav nav-tabs" id="matchTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <a class="nav-link active" id="newlyMatchedTab" data-bs-toggle="tab" href="#newlyMatched" role="tab"
              aria-controls="newlyMatched" aria-selected="true">Newly Matched</a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" id="previouslyMatchedTab" data-bs-toggle="tab" href="#previouslyMatched" role="tab"
              aria-controls="previouslyMatched" aria-selected="false">Previously Matched</a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" id="previouslyRejectedTab" data-bs-toggle="tab" href="#previouslyRejected" role="tab"
              aria-controls="previouslyRejected" aria-selected="false">Previously Rejected</a>
          </li>
        </ul>
  
        <!-- Tab Content -->
        <div class="tab-content" id="matchTabsContent">
          <!-- Newly Matched Section -->
          <div class="tab-pane fade show active" id="newlyMatched" role="tabpanel" aria-labelledby="newlyMatchedTab">
            <div *ngIf="searchResults.newly_matched && searchResults.newly_matched.length > 0 && searchResults.newly_matched[0] !== 'No newly matched persons found.'">
                <div class="row">
                <div *ngFor="let match of searchResults.newly_matched; let i = index" class="col-md-4">
                  <div class="card border-primary mb-3 mt-2" style="max-width: 100%;" [ngStyle]="{'--delay': (i * 0.5) + 's'}">
                    <div class="card-header">
                      Match ID: {{ match.match_id }}
                    </div>
                    <div class="px-3 py-2 border-bottom">
                      <strong>Previously Attempted Count:</strong> {{ searchResults.rematch_attempt }}
                    </div>
                    <div class="card-body d-flex">
                      <!-- Left Column: Unidentified Body -->
                      <div class="w-50 pe-3">
                        <h6 class="card-title">Unidentified Body</h6>
                        <!-- Safe navigation operator added to avoid errors if undefined -->
                        <p class="card-text mb-1"><strong>Body Name:</strong> {{ match.unidentified_body?.full_name || 'N/A' }}</p>
                        <p class="card-text mb-1"><strong>Location:</strong> {{ match.unidentified_body?.address.city || 'N/A' }}</p>
                      </div>
                      <!-- Right Column: Matched Entity -->
                      <div class="w-50 ps-3">
                        <h6 class="card-title">{{ match.matched_entity?.address?.type || 'N/A' }}</h6>
                        <p class="card-text mb-1"><strong>Name:</strong> {{ match.matched_entity?.full_name || 'N/A' }}</p>
                        <p class="card-text mb-1"><strong>Age:</strong> {{ match.matched_entity?.estimated_age || 'N/A' }}</p>
                      </div>
                    </div>
                    <div class="card-footer d-flex justify-content-between">
                      <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#viewDetailsModal" (click)="viewDetails(match)">View Details</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          
            <!-- No matches found message -->
            <div *ngIf="!searchResults.newly_matched || searchResults.newly_matched[0] === 'No newly matched persons found.'">
                <p class="text-muted">No newly matched persons found.</p>
            </div>
          </div>
          
  
          <!-- Previously Matched Section -->
          <div class="tab-pane fade" id="previouslyMatched" role="tabpanel" aria-labelledby="previouslyMatchedTab">
            <div *ngIf="searchResults.previously_matched && searchResults.previously_matched.length > 0; else noPreviouslyMatched">
              <div class="row">
                <div *ngFor="let match of searchResults.previously_matched; let i = index" class="col-md-4">
                  <div class="card border-success mb-3 mt-2" style="max-width: 100%;" [ngStyle]="{'--delay': (i * 0.5) + 's'}">
                    <div class="card-header">
                      Match ID: {{ match.match_id }}
                    </div>
                    <div class="px-3 py-2 border-bottom">
                      <strong>Match Percentage:</strong> {{ match.match_percentage }}%
                    </div>
                    <div class="card-body d-flex flex-column">
                      <div class="d-flex">
                        <!-- Left Column: Unidentified Body -->
                        <div class="w-50 pe-3">
                          <h6 class="card-title">Unidentified Body</h6>
                          <p class="card-text mb-1"><strong>Body ID:</strong> {{ match.unidentified_body.full_name}}</p>
                          <p class="card-text mb-1"><strong>Age:</strong> {{ match.unidentified_body.estimated_age}}</p>
                          <p class="card-text mb-1"><strong>City:</strong> {{ match.unidentified_body.address.city }}</p>
                          <p class="card-text mb-1"><strong>Phone:</strong> {{ match.unidentified_body.contact.phone_number }}</p>
                        </div>
                        <!-- Right Column: Matched Entity -->
                        <div class="w-50 ps-3">
                          <h6 class="card-title">Matched Entity</h6>
                          <p class="card-text mb-1"><strong>Name:</strong> {{ match.matched_entity.full_name }}</p>
                          <p class="card-text mb-1"><strong>Age:</strong> {{ match.matched_entity.age || match.matched_entity.estimated_age}}</p>
                          <p class="card-text mb-1"><strong>City:</strong> {{ match.matched_entity.address.city }}</p>
                          <p class="card-text mb-1"><strong>Contact:</strong> {{ match.matched_entity.contact.phone_number }}</p>
                        </div>
                      </div>
                    </div>
                    <div class="card-footer d-flex justify-content-between">
                      <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#viewDetailsModal" (click)="viewDetails(match)">View Details</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <ng-template #noPreviouslyMatched>
              <p class="text-muted">No previously matched bodies found.</p>
            </ng-template>
          </div>
          
  
          <!-- Previously Rejected Section -->
          <div class="tab-pane fade" id="previouslyRejected" role="tabpanel" aria-labelledby="previouslyRejectedTab">
            <!-- Check if previously_rejected has valid data (and not the "No previously rejected persons found." message) -->
            <div *ngIf="searchResults.previously_rejected && searchResults.previously_rejected.length > 0 && searchResults.previously_rejected[0] !== 'No previously rejected persons found.'">
              <div class="row">
                <div *ngFor="let rejected of searchResults.previously_rejected; let i = index" class="col-md-4">
                  <div class="card border-danger mb-3 mt-2" style="max-width: 100%;" [ngStyle]="{'--delay': (i * 0.5) + 's'}">
                    <div class="card-header">
                      Match ID: {{ rejected.match_id || 'N/A' }}
                    </div>
                    <div class="px-3 py-2 border-bottom">
                      <strong>Previously Attempted Count:</strong> {{ searchResults.rematch_attempt || 'N/A' }}
                    </div>
                    <div class="card-body d-flex flex-column">
                      <div class="d-flex">
                        <!-- Left Column -->
                        <div class="w-50 pe-3">
                          <h6 class="card-title">Rejected Entity</h6>
                          <p class="card-text mb-1"><strong>Matched With:</strong> {{ rejected.Matched_With || 'N/A' }}</p>
                          <p class="card-text mb-1"><strong>Name:</strong> {{ rejected.name || 'N/A' }}</p>
                          <p class="card-text mb-1"><strong>Match Percentage:</strong> {{ rejected.match_percentage ? rejected.match_percentage + '%' : 'N/A' }}</p>
                        </div>
                        <!-- Right Column -->
                        <div class="w-50 ps-3">
                          <h6 class="card-title">Rejection Details</h6>
                          <p class="card-text mb-1"><strong>Rejection Reason:</strong> {{ rejected.rejection_reason || 'Not provided' }}</p>
                        </div>
                      </div>
                    </div>
                    <div class="card-footer d-flex justify-content-between"></div>
                  </div>
                </div>
              </div>
            </div>
          
            <!-- Message when no valid previously rejected bodies are found -->
            <div *ngIf="searchResults.previously_rejected[0] === 'No previously rejected persons found.'">
              <p class="text-muted">No previously rejected bodies found.</p>
            </div>
          </div>
          
          
          
          
        </div>
      </div>
    </div>
  </div>
  





<!-- Modal for Viewing Details -->
<div class="modal fade" id="viewDetailsModal" tabindex="-1" aria-labelledby="viewDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="viewDetailsModalLabel">Match Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div *ngIf="selectedMatch" class="row">
            <!-- Unidentified Body Details -->
            <div class="col-md-6 border-end">
              <h6 class="text-primary">Unidentified Body</h6>
              <img
                [src]="selectedMatch?.unidentified_body?.photo_upload ? (environment.apiUrl + selectedMatch.unidentified_body.photo_upload) : 'assets/images/pngwing.com.png'"
                alt="Unidentified Body Photo"
                class="img-fluid rounded mb-3"
                style="max-height: 200px; object-fit: cover;"
              />
              <!-- Table with Unidentified Body Details -->
              <table class="table table-bordered">
                <tbody>
                  <tr>
                    <td><strong>Name:</strong></td>
                    <td>{{ selectedMatch?.unidentified_body?.full_name || 'N/A' }}</td>
                  </tr>
                  <tr>
                    <td><strong>Age:</strong></td>
                    <td>{{ selectedMatch?.unidentified_body?.estimated_age || 'N/A' }}</td>
                  </tr>
                  <tr>
                    <td><strong>Gender:</strong></td>
                    <td>{{ selectedMatch?.unidentified_body?.gender || 'N/A' }}</td>
                  </tr>
                  <tr>
                    <td><strong>Location:</strong></td>
                    <td>{{ selectedMatch?.unidentified_body?.address?.full_address || 'N/A' }}</td>
                  </tr>
                  <tr>
                    <td><strong>City:</strong></td>
                    <td>{{ selectedMatch?.unidentified_body?.address?.city || 'N/A' }}</td>
                  </tr>
                  <tr>
                    <td><strong>Contact Number:</strong></td>
                    <td>{{ selectedMatch?.unidentified_body?.contact?.phone_number || 'N/A' }}</td>
                  </tr>
                  <tr>
                    <td><strong>Discovered By:</strong></td>
                    <td>{{ selectedMatch?.unidentified_body?.discovered_by || 'N/A' }}</td>
                  </tr>
                  <tr>
                    <td><strong>Discovery Date:</strong></td>
                    <td>{{ selectedMatch?.unidentified_body?.discovery_date || 'N/A' }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
  
            <!-- Matched Entity Details -->
            <div class="col-md-6">
              <h6 class="text-success">Matched Entity</h6>
              <img
                [src]="selectedMatch?.matched_entity?.photo_upload ? (environment.apiUrl + selectedMatch.matched_entity.photo_upload) : 'assets/images/pngwing.com.png'"
                alt="Matched Entity Photo"
                class="img-fluid rounded mb-3"
                style="max-height: 200px; object-fit: cover;"
              />
              <!-- Table with Matched Entity Details -->
              <table class="table table-bordered">
                <tbody>
                  <tr>
                    <td><strong>Name:</strong></td>
                    <td>{{ selectedMatch?.matched_entity?.full_name || 'N/A' }}</td>
                  </tr>
                  <tr>
                    <td><strong>Estimated Age:</strong></td>
                    <td>{{ selectedMatch?.matched_entity?.estimated_age || 'N/A' }}</td>
                  </tr>
                  <tr>
                    <td><strong>Blood Group:</strong></td>
                    <td>{{ selectedMatch?.matched_entity?.blood_group || 'N/A' }}</td>
                  </tr>
                  <tr>
                    <td><strong>Condition:</strong></td>
                    <td>{{ selectedMatch?.matched_entity?.condition || 'N/A' }}</td>
                  </tr>
                  <tr>
                    <td><strong>Location:</strong></td>
                    <td>{{ selectedMatch?.matched_entity?.address?.full_address || 'N/A' }}</td>
                  </tr>
                  <tr>
                    <td><strong>Phone:</strong></td>
                    <td>{{ selectedMatch?.matched_entity?.contact?.phone_number || 'N/A' }}</td>
                  </tr>
                  <tr>
                    <td><strong>Case Status:</strong></td>
                    <td>{{ selectedMatch?.matched_entity?.case_status || 'N/A' }}</td>
                  </tr>
                  <tr>
                    <td><strong>Last Seen Location:</strong></td>
                    <td>{{ selectedMatch?.matched_entity?.last_seen_location || 'N/A' }}</td>
                  </tr>
                  <tr>
                    <td><strong>Police Station:</strong></td>
                    <td>{{ selectedMatch?.matched_entity?.police_station_name_and_address?.name || 'N/A' }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <!-- <button type="button" class="btn btn-danger" (click)="openRejectModal()">Reject Match</button> -->
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  
  