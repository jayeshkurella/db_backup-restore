<div class="heading-container">
  <h3 class="main-heading">Search Unidnetified Bodies</h3>
</div>

<div class="container-fluid mt-2">
  
  <div *ngIf="loading" class="fullscreen-loader">
    <div class="progress-container">
      <div class="progress" style="height: 30px;">
        <div class="progress-bar progress-bar-striped progress-bar-animated {{ progressColor }}"
             role="progressbar"
             [style.width.%]="progress">
          {{ progress }}%
        </div>
      </div>
      <p class="text-center mt-2">{{ progressMessage }}</p>
    </div>
  </div>
  <div class="container-fluid filter-section p-3 backcss bg-light rounded shadow-sm mb-2">
    <!-- <h5 class="text-primary mb-3">Search Filters</h5> -->

    <div class="row g-2 align-items-center ">
      <div class="col-md-3">
        <select class="form-select" [(ngModel)]="filters.state" (ngModelChange)="applyFilters()">
          <option value=""  selected >State</option>
          <option *ngFor="let state of allstates" [value]="state" >{{ state }}</option>
        </select>
      </div>
      <div class="col-md-3">
        <select class="form-select" [(ngModel)]="filters.district" (ngModelChange)="applyFilters()">
          <option value="" selected >District</option>
          <option *ngFor="let district of alldistricts" [value]="district">{{ district }}</option>
        </select>
      </div>
      <div class="col-md-2">
        <select class="form-select" [(ngModel)]="filters.city" (ngModelChange)="applyFilters()">
          <option value="" selected>City</option>
          <option *ngFor="let city of allcities" [value]="city">{{ city }}</option>
        </select>
      </div>
      <div class="col-md-2">
        <select class="form-select" [(ngModel)]="filters.year" (ngModelChange)="applyFilters()">
          <option value="">Year</option>
          <option *ngFor="let year of years" [value]="year">{{ year }}</option>
        </select>
      </div>
      <div class="col-md-2">
        <select class="form-select" [(ngModel)]="filters.month" (ngModelChange)="applyFilters()">
          <option value="">Month</option>
          <option *ngFor="let month of months" [value]="month">{{ month }}</option>
        </select>
      </div>
    </div>

    <div class="row g-2 align-items-center mt-1 ">
      <div class="col-md-3">
        <select class="form-select" [(ngModel)]="filters.caste"(ngModelChange)="applyFilters()">
          <option value="">Caste</option>
          <option value="Open">Open</option>
          <option value="OBC">OBC</option>
          <option value="SC">SC</option>
          <option value="ST">ST</option>
          <option value="Others">Others</option>
        </select>
      </div>
      <div class="col-md-3">
        <input type="text" class="form-control" placeholder="Age" [(ngModel)]="filters.age" (ngModelChange)="applyFilters()"/>
      </div>
      <div class="col-md-2">
        <select class="form-select" [(ngModel)]="filters.marital_status"(ngModelChange)="applyFilters()">
          <option value="">Marital Status</option>
          <option *ngFor="let marital of allmarital" [value]="marital">{{ marital }}</option>
        </select>
      </div>
      <div class="col-md-2">
        <select class="form-select" [(ngModel)]="filters.blood_group"(ngModelChange)="applyFilters()">
          <option value="">Blood Group</option>
          <option value="A+">A+</option>
          <option value="A-">A-</option>
          <option value="B+">B+</option>
          <option value="B-">B-</option>
          <option value="O+">O+</option>
          <option value="O-">O-</option>
          <option value="AB+">AB+</option>
          <option value="AB-">AB-</option>
        </select>
      </div>
      <div class="col-md-2">
        <input type="text" class="form-control" placeholder="Height" [(ngModel)]="filters.height" (ngModelChange)="applyFilters()"/>
      </div>
      <!-- <div class="col-md-2">
        <button class="btn btn-outline-success primary w-100" (click)="applyFilters()">Apply Filters</button>
      </div> -->
    </div>
  </div>

  <div *ngIf="!filtersApplied">
    <p class="text-center text-muted mt-3">Please apply the filters to find your person.</p>
  </div>

    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>Sr No.</th>
            <th>Photo</th>
            <th>Full Name</th>
            <th>Age</th>
            <th>Gender</th>
            <th>Action</th>
            <th style="width: 150px;">Match With</th>

          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let person of filteredPersons; let i = index">
            <td>{{ i + 1 }}</td>
            <td>
              <div class="image-container">
                <img [src]="person.body_photo_upload ? (environment.apiUrl + person.body_photo_upload) : 'assets/images/Nophoto.png'" alt=" No Body Photo" class="img-fluid rounded" />
              </div>
            </td>
            <td>{{ person?.full_name || 'Unknown' }}</td>
            <td>{{ person.estimated_age }}</td>
            <td>{{ person.gender }}</td>
            <td>
              <button class="btn btn-outline-dark" (click)="viewDetails(person)">View</button>
            </td>
            <td>
              <button class="btn btn-outline-success me-1" >UP</button>
              <button class="btn btn-outline-dark" >UB</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div *ngIf="filtersApplied && filteredPersons.length === 0">
      <p class="text-center text-danger">No persons found with the applied filters.</p>
    </div>
    <div *ngIf="unidentifiedbodies?.length > 0">
      <app-pagination
        [currentPage]="pagination.current_page"
        [totalPages]="pagination.total_pages"
        [hasPrevious]="pagination.has_previous"
        [hasNext]="pagination.has_next"
        (pageChange)="onPageChangeevent($event)">
      </app-pagination>
    </div>
    <div *ngIf="filteredPersons.length === 0">
      <p>No Persons Available.</p>
    </div>
  </div>
  
      
<!-- model for the to show data of unidentified bodies -->
  <div class="modal fade" id="personModal" tabindex="-1" aria-labelledby="personModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="personModalLabel">unidentified Body Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div *ngIf="selectedPerson" class="container">
            <!-- Person Overview Section -->
            <div class="row mb-4">
              <div class="col-md-5 text-center">
                <img [src]="selectedPerson.body_photo_upload ? (environment.apiUrl + selectedPerson.body_photo_upload) : 'assets/images/Nophoto.png'" alt="No body photo" class="img-fluid rounded">
              </div>
              <div class="col-md-7">
                <h4>{{ selectedPerson.full_name }}</h4>
                <p><strong>Age:</strong> {{ selectedPerson.estimated_age }}</p>
                <p><strong>Gender:</strong> {{ selectedPerson.gender }}</p>
                <p><strong>Blood Group:</strong> {{ selectedPerson.blood_group }}</p>
                <p><strong>Condition:</strong> {{ selectedPerson.condition || 'N/A' }}</p>
                <p><strong>Body Seen Location:</strong> {{ selectedPerson.body_seen_details }}</p>
              </div>
            </div>
  
            <!-- Appearance Information Section -->
            <h5 class="mb-3 text-primary">Appearance Information</h5>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Height:</strong></div>
              <div class="col-md-9">{{ selectedPerson.height || 'N/A' }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Weight:</strong></div>
              <div class="col-md-9">{{ selectedPerson.weight || 'N/A' }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Complexion:</strong></div>
              <div class="col-md-9">{{ selectedPerson.complexion || 'N/A' }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Hair Color:</strong></div>
              <div class="col-md-9">{{ selectedPerson.hair_color || 'N/A' }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Hair Type:</strong></div>
              <div class="col-md-9">{{ selectedPerson.hair_type || 'N/A' }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Eye Color:</strong></div>
              <div class="col-md-9">{{ selectedPerson.eye_color || 'N/A' }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Birth Mark:</strong></div>
              <div class="col-md-9">{{ selectedPerson.birth_mark || 'N/A' }}</div>
            </div> 
            <div class="row mb-3">
              <div class="col-md-3"><strong>Distinctive Mark:</strong></div>
              <div class="col-md-9">{{ selectedPerson.other_distinctive_mark || 'N/A' }}</div>
            </div>
  
            <div class="row mb-3">
              <div class="col-md-3"><strong>clothing description:</strong></div>
              <div class="col-md-9">{{ selectedPerson.clothing_description || 'N/A' }}</div>
            </div>
            <!-- Contact Information Section -->
            <h5 class="mb-3 text-primary">Contact Information</h5>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Phone Number:</strong></div>
              <div class="col-md-9">{{ selectedPerson.contact.phone_number }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Email:</strong></div>
              <div class="col-md-9">{{ selectedPerson.contact.email }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Contact Type:</strong></div>
              <div class="col-md-9">{{ selectedPerson.contact.type }}({{ selectedPerson.contact.subtype }})</div>
            </div>
  
            <!-- Address Information Section -->
            <h5 class="mb-3 text-primary">Address Information</h5>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Street:</strong></div>
              <div class="col-md-9">{{ selectedPerson.address.street }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Apartment:</strong></div>
              <div class="col-md-9">{{ selectedPerson.address.apartment_number }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>City:</strong></div>
              <div class="col-md-9">{{ selectedPerson.address.city }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>State:</strong></div>
              <div class="col-md-9">{{ selectedPerson.address.state }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Country:</strong></div>
              <div class="col-md-9">{{ selectedPerson.address.country }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Postal Code:</strong></div>
              <div class="col-md-9">{{ selectedPerson.address.postal_code }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Found Location:</strong></div>
              <div class="col-md-9">{{ selectedPerson.address.location }}</div>
            </div>
  
            <!-- Hospital Information Section -->
            <h5 class="mb-3 text-primary">Hospital Information</h5>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Hospital Name:</strong></div>
              <div class="col-md-9">{{ selectedPerson.hospital.name }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Hospital Type:</strong></div>
              <div class="col-md-9">{{ selectedPerson.hospital.entity_type }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Hospital Address:</strong></div>
              <div class="col-md-9">{{ selectedPerson.hospital.hospital_address }}</div>
            </div>
  
            <!-- Investigation Details -->
            <h5 class="mb-3 text-primary">Investigation Details</h5>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Voluenteer Name:</strong></div>
              <div class="col-md-9">{{ selectedPerson?.Volunteers?.full_name || 'N/A' }}</div>            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Voluenteer contact number:</strong></div>
              <div class="col-md-9">{{ selectedPerson?.Volunteers?.contact.phone_number}}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Voluenteer Email :</strong></div>
              <div class="col-md-9">{{ selectedPerson?.Volunteers?.contact.email}}</div>
            </div>
            <h5 class="mb-3 text-primary">Police station Details</h5>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Police Station:</strong></div>
              <div class="col-md-9">{{ selectedPerson.police_station_name_and_address.name }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Police Station Address:</strong></div>
              <div class="col-md-9">{{ selectedPerson.police_station_name_and_address.address }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Police Station Contact number :</strong></div>
              <div class="col-md-9">{{ selectedPerson.police_station_name_and_address.telephone_no }}</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Investigating Officer:</strong></div>
              <div class="col-md-9">{{ selectedPerson.investigating_officer_name}} ({{selectedPerson.investigating_officer_contact_number}})</div>
            </div>
            <div class="row mb-3">
              <div class="col-md-3"><strong>Investigating Officer contact:</strong></div>
              <div class="col-md-9">{{selectedPerson.investigating_officer_contact_number}}</div>
            </div>
            
            <div class="row mb-3">
              <div class="col-md-3"><strong>FIR Number:</strong></div>
              <div class="col-md-9">{{ selectedPerson.fir_number }}</div>
            </div>
            <!-- Map Section -->
            <h5 class="mb-3 text-primary">Location of Found Body</h5>
            <div class="row mb-3">
              <div class="col-md-12">
                <div id="map" ></div>
              </div>
            </div>         
           </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  
  

  